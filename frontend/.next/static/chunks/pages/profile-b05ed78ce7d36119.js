(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{9344:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return a(2820)}])},2820:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return s}});var n=a(5893),i=a(7294),r=a(1163),l=a.n(r);let o=(a(3454).env.NEXT_PUBLIC_API_URL||"http://localhost:4000").replace(/\/$/,"");function s(){var e;let[t,a]=(0,i.useState)(null),[r,s]=(0,i.useState)(null),[d,c]=(0,i.useState)(null),[u,p]=(0,i.useState)(!1);async function h(){try{await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,password})}),a(res.data.user)}catch(e){console.error("load me error",e),l().push("/login")}}async function f(e){if(e.preventDefault(),!r)return alert("Choose an image first");p(!0);try{let e=new FormData;e.append("avatar",r),await axios.post("".concat(o,"/api/users/me/avatar"),e,{withCredentials:!0,headers:{"Content-Type":"multipart/form-data"}}),await h(),s(null),c(null),alert("Avatar uploaded")}catch(e){var t,a;console.error("upload err",e),alert((null==e?void 0:null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.error)||"Upload failed")}finally{p(!1)}}async function v(){if(confirm("Remove your profile photo?")){p(!0);try{await axios.delete("".concat(o,"/api/users/me/avatar"),{withCredentials:!0}),await h(),alert("Avatar removed")}catch(e){console.error("remove avatar err",e),alert("Remove failed")}finally{p(!1)}}}return((0,i.useEffect)(()=>{h()},[]),t)?(0,n.jsxs)("div",{style:{maxWidth:760,margin:"40px auto",padding:20},children:[(0,n.jsx)("h2",{children:"Profile"}),(0,n.jsxs)("div",{style:{display:"flex",gap:20,alignItems:"center",marginBottom:20},children:[(0,n.jsx)("div",{children:t.avatar?(0,n.jsx)("img",{src:(e=t.avatar)?"".concat(o).concat(e.startsWith("/")?e:"/"+e):null,alt:"avatar",style:{width:120,height:120,borderRadius:12,objectFit:"cover"}}):(0,n.jsx)("div",{style:{width:120,height:120,borderRadius:12,background:"#ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:32},children:t.username?t.username.charAt(0).toUpperCase():"?"})}),(0,n.jsxs)("div",{style:{flex:1},children:[(0,n.jsx)("div",{style:{fontWeight:700,fontSize:18},children:t.username}),(0,n.jsxs)("div",{style:{color:"#666",marginTop:6},children:["Member since: ",new Date(t.created_at).toLocaleString()]}),(0,n.jsx)("div",{style:{marginTop:18},children:(0,n.jsxs)("form",{onSubmit:f,children:[(0,n.jsx)("input",{type:"file",accept:"image/png,image/jpeg,image/webp",onChange:function(e){var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a){s(null),c(null);return}s(a),c(URL.createObjectURL(a))}}),d&&(0,n.jsx)("div",{style:{marginTop:12},children:(0,n.jsx)("img",{src:d,alt:"preview",style:{width:120,height:120,objectFit:"cover",borderRadius:8}})}),(0,n.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8},children:[(0,n.jsx)("button",{type:"submit",disabled:u||!r,style:{padding:"8px 12px"},children:u?"Uploading...":"Upload"}),(0,n.jsx)("button",{type:"button",onClick:()=>{s(null),c(null)},style:{padding:"8px 12px"},children:"Cancel"}),t.avatar&&(0,n.jsx)("button",{type:"button",onClick:v,style:{padding:"8px 12px",background:"#fee"},children:"Remove"})]})]})})]})]}),(0,n.jsx)("div",{children:(0,n.jsx)("button",{onClick:()=>l().push("/chat"),style:{padding:"8px 12px"},children:"Back to Chat"})})]}):(0,n.jsx)("div",{style:{padding:20},children:"Loading..."})}},1163:function(e,t,a){e.exports=a(9090)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=9344)}),_N_E=e.O()}]);